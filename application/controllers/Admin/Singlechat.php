<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class Singlechat extends MY_Controller {       public function __Construct(){		  parent::__Construct();		  $this->template_load2();	  }	public function index()	{	   if($this->session->userdata('subadmin_data')){		$sess = $this->session->userdata('subadmin_data');	    $data['question_detail'] = $this->Admin_model->question_single_chat($sess[0]->admin_cat_id);		$this->load->view('Admin/single_chat',$data);	     } else{             $this->load->view('Admin/Login');	     }	}	public function single_chatassign(){		 if($this->session->userdata('subadmin_data')){		  $qust_id = $this->uri->segment('4');	      $data['single_question'] = $this->Admin_model->single_user_assign($qust_id);		  $subadmin = $this->session->userdata('Admin/subadmin_data');	      $catid = $subadmin[0]->admin_cat_id;		  $subcatid = $data['single_question'][0]->subcat_id;	      $data['subcat_expert'] = $this->Admin_model->expert_detail2($catid,$subcatid);		  $this->load->view('Admin/single_chat_detail',$data);		 } else{			   $this->load->view('Admin/Login');		 }	}    public function single_chat_assign_submit(){	   $expert_id = $this->input->post('expert_id');	   $qust_id = $this->input->post('qust_id');	   $user_id = $this->input->post('user_id');	   $res = $this->Admin_model->update_single_chat_assign($qust_id,$expert_id);	   if($res == true){		   $data['expert_id']=$expert_id;		   $data['user_id'] =$user_id; 		   $res2 = $this->email_and_message_send($data);		   if($res2 == true){		   echo "1";			}	   }   }   public function viewassign(){       $q_id = $this->uri->segment('4');       $data['single_question'] = $this->Admin_model->single_user_assign2($q_id);       if($this->session->userdata('subadmin_data')){       	 $subadmindata = $this->session->userdata('subadmin_data');       	 $cat_id = $subadmindata[0]->admin_cat_id;       	 $subcat_id = $data['single_question'][0]->subcat_id;        $data['subcat_expert'] = $this->Admin_model->expert_detail2($cat_id,$subcat_id);             	$this->load->view('Admin/single_chat_detail',$data);       	 }          }   	  public function email_and_message_send($data){		$user_detail = $this->Main_model->user_detail_usinguserid($data['user_id']);		$expert_detail = $this->Admin_model->expert_detailbyexp_id($data['expert_id']);		$user_email = $user_detail[0]->useremail;		$user_name = $user_detail[0]->username;		$user_mobile = $user_detail[0]->usermobile;				$link_user = base_url()."user";				$user_mail_body = email_load($user_name,$link_user,"user1");		$expert_email = $expert_detail[0]->expert_email;		$expert_name = $expert_detail[0]->expert_name;		$expert_mobile = $expert_detail[0]->expert_mobile;				$link_expert = base_url()."Advicer/";			        $expert_mail_body = email_load($expert_name,$link_expert,"expert1");		//expert_mail	        $image_logo = base_url()."assets/admin/images/img1.jpg";       $this->load->library('phpmailer_lib');       $mail = $this->phpmailer_lib->loadmail();       $mail->isSMTP();       $mail->SMTPOptions = array (        'ssl' => array(            'verify_peer'  => false,            'verify_peer_name'  => false,            'allow_self_signed' => true));       //$mail->SMTPDebug = 3;       $mail->Debugoutput = 'html';       $mail->Host = "bestadvicer.com";       $mail->SMTPAuth = true;       $mail->SMTPSecure = 'tls';       $mail->Port = 587;       $mail->Username ="best@bestadvicer.com";       $mail->Password ="67D#AvLfzl51-W";       $mail->SetFrom('ashish@bestadvicer.com','BestAdvicer');       $mail->addReplyTo('ashish@bestadvicer.com','BestAdvicer Verification');       $mail->addAddress($expert_email);       $mail->Subject = 'Question Alert';       $mail->isHTML(true);$mail->Body = $expert_mail_body; if($mail->send()){    //user_mail	          $image_logo = base_url()."assets/admin/images/img1.jpg";       $this->load->library('phpmailer_lib');       $mail = $this->phpmailer_lib->loadmail();       $mail->isSMTP();       $mail->SMTPOptions = array (        'ssl' => array(            'verify_peer'  => false,            'verify_peer_name'  => false,            'allow_self_signed' => true));       //$mail->SMTPDebug = 3;       $mail->Debugoutput = 'html';       $mail->Host = "bestadvicer.com";       $mail->SMTPAuth = true;       $mail->SMTPSecure = 'tls';       $mail->Port = 587;       $mail->Username ="best@bestadvicer.com";       $mail->Password ="67D#AvLfzl51-W";       $mail->SetFrom('ashish@bestadvicer.com','BestAdvicer');       $mail->addReplyTo('ashish@bestadvicer.com','BestAdvicer Verification');       $mail->addAddress($user_email);       $mail->Subject = 'Bestadvicer Answer Alert';       $mail->isHTML(true);       $mail->Body = $user_mail_body; if($mail->send()){$apiKey = urlencode('7f8bce08-afe6-11ea-9fa5-0200cd936042');$sender = urlencode('BSTADV');$SMS = "SMS"; $res_expert_sms = $this->sms_send_to_expert($expert_mobile,$sender,$SMS,$apiKey,$expert_name,$link_expert);$res_user_sms = $this->sms_send_to_user($user_mobile,$sender,$SMS,$apiKey,$user_name,$link_user);if($res_expert_sms == true && $res_user_sms == true ){	return true;}else { return false; }} else{  echo "Mailer Error".$mail->ErrorInfo; } } else{   echo "Mailer Error".$mail->ErrorInfo; }//end_user_mail		}	public function sms_send_to_user($numbers,$sender,$SMS,$apikey,$user_name,$link_user){		//$message = rawurlencode('Dear User your OTP is '.$OTP.' for Please enter OTP to complete your query');// Prepare data for POST request// Send the POST request with cURL$agent= 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.0.3705; .NET CLR 1.1.4322)';$url = "https://2factor.in/API/R1/?module=TRANS_SMS"; $ch = curl_init(); curl_setopt($ch,CURLOPT_URL,$url); curl_setopt($ch,CURLOPT_POST,true); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch,CURLOPT_POSTFIELDS,"&apikey=".$apikey."&to=".$numbers."&from=".$sender."&templatename=Advicer Notification&var1=".$user_name."&var2=".$link_user.""); curl_setopt($ch, CURLOPT_USERAGENT, $agent);curl_exec($ch); curl_close($ch);// Process your response herereturn true;	}public function sms_send_to_expert($numbers,$sender,$SMS,$apikey,$expert_name,$link_expert){		//$message = rawurlencode('Dear User your OTP is '.$OTP.' for Please enter OTP to complete your query');// Prepare data for POST request// Send the POST request with cURL$agent= 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.0.3705; .NET CLR 1.1.4322)';$url = "https://2factor.in/API/R1/?module=TRANS_SMS"; $ch = curl_init(); curl_setopt($ch,CURLOPT_URL,$url); curl_setopt($ch,CURLOPT_POST,true); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch,CURLOPT_POSTFIELDS,"&apikey=".$apikey."&to=".$numbers."&from=".$sender."&templatename=advicernotice2&var1=".$expert_name."&var2=".$link_expert.""); curl_setopt($ch, CURLOPT_USERAGENT, $agent);curl_exec($ch); curl_close($ch);// Process your response herereturn true;	}	public function delete(){        $id = $this->uri->segment('5');        $result = $this->Admin_model->user_delete($id);        if($result == true){            redirect('Admin/User');        } else{            echo "Something wrong go back";        }	}}